{% extends "base.html" %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="h2 mb-1">Welcome back, {{ current_user.username }}!</h1>
                <p class="text-muted">Here's your learning progress and recent activity.</p>
            </div>
            <div>
                <a href="{{ url_for('decks.create') }}" class="btn btn-primary">
                    <i class="bi bi-plus-circle me-2"></i>Create New Deck
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Statistics Cards -->
<div class="row mb-4">
    <div class="col-md-3 mb-3">
        <div class="card text-center">
            <div class="card-body">
                <div class="d-flex align-items-center justify-content-center mb-2">
                    <i class="bi bi-collection fs-1 text-primary me-2"></i>
                    <span class="fs-1 fw-bold">{{ user_stats.total_decks }}</span>
                </div>
                <h6 class="card-title text-muted">Total Decks</h6>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="card text-center">
            <div class="card-body">
                <div class="d-flex align-items-center justify-content-center mb-2">
                    <i class="bi bi-card-text fs-1 text-success me-2"></i>
                    <span class="fs-1 fw-bold">{{ user_stats.total_cards }}</span>
                </div>
                <h6 class="card-title text-muted">Total Cards</h6>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="card text-center">
            <div class="card-body">
                <div class="d-flex align-items-center justify-content-center mb-2">
                    <i class="bi bi-lightning fs-1 text-warning me-2"></i>
                    <span class="fs-1 fw-bold">7</span>
                </div>
                <h6 class="card-title text-muted">Study Streak</h6>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="card text-center">
            <div class="card-body">
                <div class="d-flex align-items-center justify-content-center mb-2">
                    <i class="bi bi-trophy fs-1 text-info me-2"></i>
                    <span class="fs-1 fw-bold">85%</span>
                </div>
                <h6 class="card-title text-muted">Avg Accuracy</h6>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Recent Decks -->
    <div class="col-lg-8 mb-4">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">
                    <i class="bi bi-collection me-2"></i>Your Recent Decks
                </h5>
                <a href="{{ url_for('decks.index') }}" class="btn btn-outline-primary btn-sm">View All</a>
            </div>
            <div class="card-body">
                {% if deck_stats %}
                    <div class="row">
                        {% for deck_stat in deck_stats %}
                            <div class="col-md-6 mb-3">
                                <div class="border rounded p-3 h-100">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <h6 class="mb-1">
                                            <a href="{{ url_for('decks.view', id=deck_stat.deck.id) }}" class="text-decoration-none">
                                                {{ deck_stat.deck.name }}
                                            </a>
                                        </h6>
                                        {% if deck_stat.deck.is_public %}
                                            <span class="badge bg-success">Public</span>
                                        {% else %}
                                            <span class="badge bg-secondary">Private</span>
                                        {% endif %}
                                    </div>

                                    <p class="text-muted small mb-2">
                                        {{ deck_stat.deck.description[:60] }}{% if deck_stat.deck.description|length > 60 %}...{% endif %}
                                    </p>

                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <small class="text-muted">
                                            {{ deck_stat.stats.total_cards }} cards
                                        </small>
                                        {% if deck_stat.stats.avg_accuracy > 0 %}
                                            <span class="badge {{ accuracy_badge_class(deck_stat.stats.avg_accuracy) }}">
                                                {{ deck_stat.stats.avg_accuracy }}% accuracy
                                            </span>
                                        {% endif %}
                                    </div>

                                    <div class="d-flex gap-2">
                                        <a href="{{ url_for('study.start', deck_id=deck_stat.deck.id) }}" class="btn btn-primary btn-sm flex-fill">
                                            <i class="bi bi-play-circle me-1"></i>Study
                                        </a>
                                        <a href="{{ url_for('decks.view', id=deck_stat.deck.id) }}" class="btn btn-outline-secondary btn-sm">
                                            <i class="bi bi-eye me-1"></i>View
                                        </a>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-5">
                        <i class="bi bi-collection display-1 text-muted mb-3"></i>
                        <h5 class="text-muted">No decks yet</h5>
                        <p class="text-muted">Create your first flashcard deck to start learning!</p>
                        <a href="{{ url_for('decks.create') }}" class="btn btn-primary">
                            <i class="bi bi-plus-circle me-2"></i>Create Your First Deck
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="col-lg-4">
        <!-- Quick Actions -->
        <div class="card mb-4">
            <div class="card-header">
                <h6 class="card-title mb-0">
                    <i class="bi bi-lightning-charge me-2"></i>Quick Actions
                </h6>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{{ url_for('decks.create') }}" class="btn btn-primary">
                        <i class="bi bi-plus-circle me-2"></i>Create New Deck
                    </a>
                    <a href="{{ url_for('decks.public') }}" class="btn btn-outline-primary">
                        <i class="bi bi-search me-2"></i>Browse Public Decks
                    </a>
                    <a href="{{ url_for('auth.profile') }}" class="btn btn-outline-secondary">
                        <i class="bi bi-person me-2"></i>Edit Profile
                    </a>
                </div>
            </div>
        </div>

        <!-- Decks Needing Attention -->
        {% if decks_needing_attention %}
        <div class="card mb-4">
            <div class="card-header">
                <h6 class="card-title mb-0">
                    <i class="bi bi-exclamation-triangle me-2"></i>Needs Review
                </h6>
            </div>
            <div class="card-body">
                {% for deck_attention in decks_needing_attention %}
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <div>
                            <a href="{{ url_for('study.review', deck_id=deck_attention.deck.id) }}" class="text-decoration-none">
                                {{ deck_attention.deck.name }}
                            </a>
                            <br>
                            <small class="text-muted">{{ deck_attention.review_count }} cards need practice</small>
                        </div>
                        <a href="{{ url_for('study.review', deck_id=deck_attention.deck.id) }}" class="btn btn-warning btn-sm">
                            Review
                        </a>
                    </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Recent Activity -->
        <div class="card">
            <div class="card-header">
                <h6 class="card-title mb-0">
                    <i class="bi bi-clock-history me-2"></i>Recent Activity
                </h6>
            </div>
            <div class="card-body">
                <div class="small text-muted">
                    <div class="d-flex align-items-center mb-2">
                        <i class="bi bi-plus-circle me-2"></i>
                        <span>Created deck "Spanish Vocabulary" 2 days ago</span>
                    </div>
                    <div class="d-flex align-items-center mb-2">
                        <i class="bi bi-play-circle me-2"></i>
                        <span>Studied "Math Formulas" 3 days ago</span>
                    </div>
                    <div class="d-flex align-items-center mb-2">
                        <i class="bi bi-card-text me-2"></i>
                        <span>Added 5 cards to "History Facts" 1 week ago</span>
                    </div>
                    <div class="d-flex align-items-center">
                        <i class="bi bi-trophy me-2"></i>
                        <span>Achieved 90% accuracy in "Science Terms" 1 week ago</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Study Today Section -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card bg-primary text-white">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h4 class="card-title">Ready to study today?</h4>
                        <p class="card-text mb-0">Keep your learning streak alive! Pick a deck and start studying.</p>
                    </div>
                    <div class="col-md-4 text-md-end">
                        <a href="{{ url_for('decks.index') }}" class="btn btn-light">
                            <i class="bi bi-play-circle me-2"></i>Start Studying
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
