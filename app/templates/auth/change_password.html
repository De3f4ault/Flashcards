{% extends "base.html" %}

{% block content %}
<div style="padding-top: calc(var(--navbar-height) + var(--space-2xl)); padding-bottom: var(--space-2xl); min-height: 100vh;">
    <div class="container" style="max-width: 600px;">

        <!-- Page Header -->
        <div style="text-align: center; margin-bottom: var(--space-xl);">
            <div style="display: inline-flex; align-items: center; justify-content: center; width: 64px; height: 64px; background: linear-gradient(135deg, #eab308 0%, #f59e0b 100%); border-radius: var(--radius-xl); margin-bottom: var(--space-md); box-shadow: var(--shadow-lg);">
                <span style="font-size: 32px;">üîë</span>
            </div>
            <h1 style="font-size: var(--font-size-3xl); font-weight: var(--font-weight-extrabold); margin-bottom: 8px;">Change Password</h1>
            <p style="color: var(--color-text-tertiary); font-size: var(--font-size-md);">Update your account password for security</p>
        </div>

        <!-- Change Password Form -->
        <div style="background: var(--color-bg-secondary); border: 1px solid var(--color-border-light); border-radius: var(--radius-xl); padding: var(--space-xl); box-shadow: var(--shadow-lg);">
            <form method="POST">
                {{ form.hidden_tag() }}

                <!-- Current Password -->
                <div class="form-group">
                    <label for="{{ form.current_password.id }}" class="form-label" style="display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 20px;">üîí</span>
                        {{ form.current_password.label.text }}
                    </label>
                    {{ form.current_password(class="form-input" + (" error" if form.current_password.errors else ""), type="password") }}
                    {% for error in form.current_password.errors %}
                        <div class="form-error">{{ error }}</div>
                    {% endfor %}
                </div>

                <!-- New Password -->
                <div class="form-group">
                    <label for="{{ form.new_password.id }}" class="form-label" style="display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 20px;">üîê</span>
                        {{ form.new_password.label.text }}
                    </label>
                    {{ form.new_password(class="form-input" + (" error" if form.new_password.errors else ""), type="password", id="new-password") }}
                    {% for error in form.new_password.errors %}
                        <div class="form-error">{{ error }}</div>
                    {% endfor %}
                    <div class="form-help">Minimum 6 characters</div>

                    <!-- Password Strength Indicator -->
                    <div id="password-strength" style="margin-top: 8px; display: none;">
                        <div style="font-size: var(--font-size-xs); color: var(--color-text-muted); margin-bottom: 4px;">Password Strength:</div>
                        <div style="height: 4px; background: var(--overlay-medium); border-radius: 2px; overflow: hidden;">
                            <div id="strength-bar" style="height: 100%; width: 0%; transition: width 0.3s ease, background-color 0.3s ease;"></div>
                        </div>
                        <div id="strength-text" style="font-size: var(--font-size-xs); margin-top: 4px;"></div>
                    </div>
                </div>

                <!-- Confirm New Password -->
                <div class="form-group">
                    <label for="{{ form.new_password2.id }}" class="form-label" style="display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 20px;">‚úì</span>
                        {{ form.new_password2.label.text }}
                    </label>
                    {{ form.new_password2(class="form-input" + (" error" if form.new_password2.errors else ""), type="password") }}
                    {% for error in form.new_password2.errors %}
                        <div class="form-error">{{ error }}</div>
                    {% endfor %}
                </div>

                <!-- Action Buttons -->
                <div style="display: flex; gap: 12px; margin-top: var(--space-xl);">
                    <a href="{{ url_for('auth.profile') }}" class="btn btn-secondary" style="flex: 1;">
                        Cancel
                    </a>
                    {{ form.submit(class="btn", style="flex: 2; background: linear-gradient(135deg, #eab308 0%, #f59e0b 100%); color: white;") }}
                </div>
            </form>
        </div>

        <!-- Security Tips Card -->
        <div style="background: var(--color-bg-secondary); border: 1px solid var(--color-border-light); border-radius: var(--radius-lg); padding: var(--space-lg); margin-top: var(--space-md);">
            <h6 style="font-weight: var(--font-weight-bold); margin-bottom: var(--space-sm); display: flex; align-items: center; gap: 8px;">
                <span>üõ°Ô∏è</span> Password Security Tips
            </h6>
            <ul style="margin: 0; padding-left: 24px; color: var(--color-text-tertiary); font-size: var(--font-size-sm); line-height: var(--line-height-relaxed);">
                <li>Use at least 8 characters for better security</li>
                <li>Include a mix of uppercase, lowercase, numbers, and symbols</li>
                <li>Avoid common words or personal information</li>
                <li>Don't reuse passwords from other accounts</li>
                <li>Consider using a password manager</li>
            </ul>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const newPasswordInput = document.getElementById('new-password');
        const strengthIndicator = document.getElementById('password-strength');
        const strengthBar = document.getElementById('strength-bar');
        const strengthText = document.getElementById('strength-text');

        if (newPasswordInput) {
            // Auto-focus current password
            const currentPassword = document.querySelector('input[name="current_password"]');
            if (currentPassword) {
                currentPassword.focus();
            }

            // Password strength checker
            newPasswordInput.addEventListener('input', function() {
                const password = this.value;

                if (password.length === 0) {
                    strengthIndicator.style.display = 'none';
                    return;
                }

                strengthIndicator.style.display = 'block';

                let strength = 0;
                let feedback = '';
                let color = '';

                // Calculate strength
                if (password.length >= 6) strength += 25;
                if (password.length >= 10) strength += 25;
                if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength += 20;
                if (/\d/.test(password)) strength += 15;
                if (/[^a-zA-Z0-9]/.test(password)) strength += 15;

                // Set feedback and color
                if (strength < 40) {
                    feedback = 'Weak';
                    color = 'var(--color-danger)';
                } else if (strength < 70) {
                    feedback = 'Fair';
                    color = 'var(--color-warning)';
                } else if (strength < 90) {
                    feedback = 'Good';
                    color = 'var(--color-info)';
                } else {
                    feedback = 'Strong';
                    color = 'var(--color-success)';
                }

                strengthBar.style.width = strength + '%';
                strengthBar.style.background = color;
                strengthText.textContent = feedback;
                strengthText.style.color = color;
            });
        }

        FlashFlow.showToast('Enter your current password to continue', 'info', 3000);
    });
</script>
{% endblock %}
