{% extends "base.html" %}

{% block content %}
<div style="padding-top: calc(var(--navbar-height) + var(--space-2xl)); padding-bottom: var(--space-2xl); min-height: 100vh;">
    <div class="container" style="max-width: 1200px;">

        <!-- Page Header -->
        <div style="text-align: center; margin-bottom: var(--space-xl);">
            <div style="display: inline-flex; align-items: center; justify-content: center; width: 80px; height: 80px; background: var(--gradient-primary); border-radius: var(--radius-full); margin-bottom: var(--space-md); box-shadow: var(--shadow-lg); font-size: 36px; color: white; font-weight: var(--font-weight-extrabold);">
                {{ current_user.username[0].upper() }}
            </div>
            <h1 style="font-size: var(--font-size-3xl); font-weight: var(--font-weight-extrabold); margin-bottom: 8px;">Edit Profile</h1>
            <p style="color: var(--color-text-tertiary); font-size: var(--font-size-md);">Manage your account information and preferences</p>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 400px; gap: var(--space-md);">
            <!-- Left Column: Edit Form -->
            <div style="background: var(--color-bg-secondary); border: 1px solid var(--color-border-light); border-radius: var(--radius-xl); padding: var(--space-xl); box-shadow: var(--shadow-lg);">
                <h2 style="font-size: var(--font-size-xl); font-weight: var(--font-weight-bold); margin-bottom: var(--space-lg); display: flex; align-items: center; gap: 8px;">
                    <span>üë§</span> Profile Information
                </h2>

                <form method="POST">
                    {{ form.hidden_tag() }}

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-md);">
                        <!-- Username Field -->
                        <div class="form-group">
                            <label for="{{ form.username.id }}" class="form-label">
                                {{ form.username.label.text }}
                            </label>
                            {{ form.username(class="form-input" + (" error" if form.username.errors else "")) }}
                            {% for error in form.username.errors %}
                                <div class="form-error">{{ error }}</div>
                            {% endfor %}
                        </div>

                        <!-- Email Field -->
                        <div class="form-group">
                            <label for="{{ form.email.id }}" class="form-label">
                                {{ form.email.label.text }}
                            </label>
                            {{ form.email(class="form-input" + (" error" if form.email.errors else "")) }}
                            {% for error in form.email.errors %}
                                <div class="form-error">{{ error }}</div>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div style="display: flex; gap: 12px; margin-top: var(--space-xl);">
                        <a href="{{ url_for('main.dashboard') }}" class="btn btn-secondary" style="flex: 1;">
                            Cancel
                        </a>
                        {{ form.submit(class="btn btn-primary", style="flex: 2;") }}
                    </div>
                </form>
            </div>

            <!-- Right Column: Sidebar -->
            <div style="display: flex; flex-direction: column; gap: var(--space-md);">
                <!-- AI Features Card -->
                <div style="background: var(--color-bg-secondary); border: 1px solid var(--color-border-light); border-radius: var(--radius-xl); overflow: hidden; box-shadow: var(--shadow-lg);">
                    <div style="background: var(--gradient-primary); padding: var(--space-lg); color: white;">
                        <h6 style="font-weight: var(--font-weight-bold); margin-bottom: 4px; display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 20px;">‚ú®</span> AI Features
                        </h6>
                    </div>
                    <div style="padding: var(--space-lg);">
                        {% if current_user.ai_enabled %}
                            <div class="alert alert-success" style="margin-bottom: var(--space-md);">
                                <strong>‚úì AI Enabled</strong>
                            </div>
                            <p style="color: var(--color-text-tertiary); font-size: var(--font-size-sm); margin-bottom: var(--space-md); line-height: var(--line-height-relaxed);">
                                Use AI to generate flashcards, enhance existing cards, and get smart study hints.
                            </p>
                            <ul style="margin: 0 0 var(--space-md) 20px; padding: 0; color: var(--color-text-tertiary); font-size: var(--font-size-sm); line-height: var(--line-height-relaxed);">
                                <li>Auto-generate flashcards from topics</li>
                                <li>Enhance existing cards with AI</li>
                                <li>Get smart hints during study</li>
                                <li>Unlimited usage</li>
                            </ul>
                            <form method="POST" action="{{ url_for('auth.toggle_ai') }}">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                <button type="submit" class="btn" style="width: 100%; background: rgba(239, 68, 68, 0.2); border: 2px solid var(--color-danger); color: var(--color-danger);">
                                    <span style="margin-right: 8px;">‚úó</span>Disable AI Features
                                </button>
                            </form>
                        {% else %}
                            <div class="alert alert-warning" style="margin-bottom: var(--space-md);">
                                <strong>‚ö† AI Disabled</strong>
                            </div>
                            <p style="color: var(--color-text-tertiary); font-size: var(--font-size-sm); margin-bottom: var(--space-md); line-height: var(--line-height-relaxed);">
                                Enable AI features to unlock:
                            </p>
                            <ul style="margin: 0 0 var(--space-md) 20px; padding: 0; color: var(--color-text-tertiary); font-size: var(--font-size-sm); line-height: var(--line-height-relaxed);">
                                <li>Auto-generate flashcards from topics</li>
                                <li>Enhance existing cards with AI</li>
                                <li>Get smart hints during study</li>
                                <li>Unlimited usage</li>
                            </ul>
                            <form method="POST" action="{{ url_for('auth.toggle_ai') }}">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                <button type="submit" class="btn btn-primary" style="width: 100%;">
                                    <span style="margin-right: 8px;">‚ú®</span>Enable AI Features
                                </button>
                            </form>
                        {% endif %}
                    </div>
                </div>

                <!-- Account Security Card -->
                <div style="background: var(--color-bg-secondary); border: 1px solid var(--color-border-light); border-radius: var(--radius-xl); padding: var(--space-lg); box-shadow: var(--shadow-md);">
                    <h6 style="font-weight: var(--font-weight-bold); margin-bottom: var(--space-md); display: flex; align-items: center; gap: 8px;">
                        <span>üîí</span> Account Security
                    </h6>
                    <p style="color: var(--color-text-tertiary); font-size: var(--font-size-sm); margin-bottom: var(--space-md); line-height: var(--line-height-relaxed);">
                        Keep your account secure by updating your password regularly.
                    </p>
                    <a href="{{ url_for('auth.change_password') }}" class="btn" style="width: 100%; background: rgba(234, 179, 8, 0.2); border: 2px solid var(--color-warning); color: var(--color-warning);">
                        <span style="margin-right: 8px;">üîë</span>Change Password
                    </a>
                </div>

                <!-- Account Info Card -->
                <div style="background: var(--color-bg-secondary); border: 1px solid var(--color-border-light); border-radius: var(--radius-xl); padding: var(--space-lg); box-shadow: var(--shadow-md);">
                    <h6 style="font-weight: var(--font-weight-bold); margin-bottom: var(--space-md); display: flex; align-items: center; gap: 8px;">
                        <span>‚ÑπÔ∏è</span> Account Info
                    </h6>
                    <div style="font-size: var(--font-size-sm); color: var(--color-text-tertiary);">
                        <div style="margin-bottom: var(--space-sm);">
                            <strong style="color: var(--color-text-secondary);">Member since:</strong><br>
                            {{ current_user.created_at.strftime('%B %d, %Y') if current_user.created_at else 'Unknown' }}
                        </div>
                        <div>
                            <strong style="color: var(--color-text-secondary);">Last updated:</strong><br>
                            {{ current_user.updated_at.strftime('%B %d, %Y at %I:%M %p') if current_user.updated_at else 'Never' }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    @media (max-width: 1024px) {
        div[style*="grid-template-columns: 1fr 400px"] {
            grid-template-columns: 1fr !important;
        }
    }

    @media (max-width: 768px) {
        div[style*="grid-template-columns: 1fr 1fr"] {
            grid-template-columns: 1fr !important;
        }
    }
</style>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        FlashFlow.showToast('Update your profile information', 'info', 3000);

        // Auto-focus first input
        const firstInput = document.querySelector('input[type="text"]');
        if (firstInput) {
            firstInput.focus();
        }
    });
</script>
{% endblock %}
