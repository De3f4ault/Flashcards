{% extends "base.html" %}

{% block hero %}
<!-- Hero Section -->
<div style="height: 50vh; min-height: 400px; position: relative; display: flex; align-items: center; padding: 0 4%; background: var(--gradient-hero);">
    <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: url('data:image/svg+xml,<svg width=\"100\" height=\"100\" xmlns=\"http://www.w3.org/2000/svg\"><defs><pattern id=\"grid\" width=\"40\" height=\"40\" patternUnits=\"userSpaceOnUse\"><path d=\"M 40 0 L 0 0 0 40\" fill=\"none\" stroke=\"rgba(255,255,255,0.03)\" stroke-width=\"1\"/></pattern></defs><rect width=\"100\" height=\"100\" fill=\"url(%23grid)\"/></svg>'); opacity: 0.5;"></div>

    <div class="container" style="position: relative; z-index: 1; max-width: 700px;">
        <div style="display: inline-block; padding: 8px 16px; background: rgba(52, 199, 89, 0.2); border: 1px solid rgba(52, 199, 89, 0.3); border-radius: var(--radius-2xl); color: var(--color-success); font-size: var(--font-size-sm); font-weight: var(--font-weight-semibold); margin-bottom: var(--space-md);">
            ğŸŒ Community Library
        </div>
        <h1 style="font-size: var(--font-size-4xl); font-weight: var(--font-weight-black); line-height: var(--line-height-tight); margin-bottom: var(--space-md); background: linear-gradient(135deg, #ffffff 0%, #a5b4fc 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
            Public Decks
        </h1>
        <p style="font-size: var(--font-size-lg); color: var(--color-text-tertiary); margin-bottom: var(--space-xl); line-height: var(--line-height-relaxed);">
            Discover and learn from community-created flashcard decks
        </p>
        {% if current_user.is_authenticated %}
        <a href="{{ url_for('decks.create') }}" class="btn btn-primary btn-lg">
            â• Create Deck
        </a>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block content %}
<!-- Search Bar -->
<div class="content-section" style="padding-top: var(--space-md);">
    <div class="container">
        <form method="GET" style="max-width: 600px; margin: 0 auto;">
            {{ search_form.hidden_tag() }}
            <div style="position: relative;">
                {{ search_form.query(class="form-input", placeholder="Search public decks...", value=query, style="padding-right: 120px;") }}
                <button type="submit" class="btn btn-primary btn-sm" style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); padding: 8px 20px;">
                    ğŸ” Search
                </button>
            </div>
        </form>

        {% if query %}
        <div style="margin-top: var(--space-sm); text-align: center;">
            <span style="color: var(--color-text-tertiary); font-size: var(--font-size-sm);">
                Searching for: <strong style="color: var(--color-text-primary);">"{{ query }}"</strong>
            </span>
            <a href="{{ url_for('decks.public') }}" class="btn btn-secondary btn-sm" style="padding: 6px 12px; font-size: var(--font-size-xs); margin-left: 12px;">
                âœ• Clear
            </a>
        </div>
        {% endif %}
    </div>
</div>

<!-- Decks Grid -->
{% if decks %}
<div class="content-section">
    <div class="container">
        <div class="deck-grid">
            {% for deck in decks %}
            <div class="deck-card">
                <div class="deck-card-image {{ ['blue', 'green', 'orange', 'purple', 'pink'][loop.index0 % 5] }}">
                    <div class="deck-card-overlay">
                        {% if 'spanish' in deck.name.lower() or 'french' in deck.name.lower() or 'language' in deck.name.lower() %}ğŸŒ
                        {% elif 'python' in deck.name.lower() or 'code' in deck.name.lower() %}ğŸ’»
                        {% elif 'math' in deck.name.lower() %}ğŸ“
                        {% elif 'science' in deck.name.lower() %}ğŸ§¬
                        {% elif 'history' in deck.name.lower() %}ğŸ“œ
                        {% else %}ğŸ“š
                        {% endif %}
                    </div>
                    <div class="deck-card-badge" style="background: rgba(52, 199, 89, 0.9);">PUBLIC</div>
                </div>

                <div class="deck-card-content">
                    <h3 class="deck-card-title">
                        <a href="{{ url_for('decks.view', id=deck.id) }}" style="color: inherit; text-decoration: none;">
                            {{ deck.name }}
                        </a>
                    </h3>

                    <p class="deck-card-description">
                        {% if deck.description %}
                            {{ deck.description[:80] }}{% if deck.description|length > 80 %}...{% endif %}
                        {% else %}
                            No description available
                        {% endif %}
                    </p>

                    <div class="deck-card-meta">
                        <div class="deck-card-meta-item">
                            ğŸƒ {{ deck.get_card_count() }} card{{ 's' if deck.get_card_count() != 1 else '' }}
                        </div>
                        <div class="deck-card-meta-item">
                            ğŸ‘¤ {{ deck.owner.username }}
                        </div>
                    </div>

                    <div class="deck-card-tags">
                        <span class="tag" style="background: rgba(52, 199, 89, 0.1); border-color: rgba(52, 199, 89, 0.3); color: var(--color-success);">ğŸŒ Public</span>
                        <span class="tag">{{ deck.get_card_count() }} Cards</span>
                    </div>

                    <div class="deck-card-actions">
                        <a href="{{ url_for('decks.view', id=deck.id) }}" class="btn-deck primary">
                            ğŸ‘ï¸ View
                        </a>
                        {% if current_user.is_authenticated %}
                        <a href="{{ url_for('decks.duplicate', id=deck.id) }}" class="btn-deck" style="background: rgba(52, 199, 89, 0.2); border-color: rgba(52, 199, 89, 0.3); color: var(--color-success);">
                            ğŸ“‹ Copy
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Pagination -->
{% if pagination and pagination.pages > 1 %}
<div class="content-section" style="padding-top: 0;">
    <div class="container">
        <div style="display: flex; justify-content: center; gap: 8px; flex-wrap: wrap;">
            {% if pagination.has_prev %}
            <a href="{{ url_for('decks.public', page=pagination.prev_num, query=query) }}" class="btn btn-secondary btn-sm">
                â€¹ Previous
            </a>
            {% endif %}

            {% for page_num in pagination.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
                {% if page_num %}
                    {% if page_num == pagination.page %}
                    <span class="btn btn-primary btn-sm" style="pointer-events: none;">{{ page_num }}</span>
                    {% else %}
                    <a href="{{ url_for('decks.public', page=page_num, query=query) }}" class="btn btn-secondary btn-sm">{{ page_num }}</a>
                    {% endif %}
                {% else %}
                    <span class="btn btn-secondary btn-sm" style="pointer-events: none; opacity: 0.5;">...</span>
                {% endif %}
            {% endfor %}

            {% if pagination.has_next %}
            <a href="{{ url_for('decks.public', page=pagination.next_num, query=query) }}" class="btn btn-secondary btn-sm">
                Next â€º
            </a>
            {% endif %}
        </div>
        <div style="text-align: center; margin-top: var(--space-sm);">
            <small style="color: var(--color-text-muted);">
                Page {{ pagination.page }} of {{ pagination.pages }} â€¢ {{ pagination.total }} total
            </small>
        </div>
    </div>
</div>
{% endif %}

{% else %}
<!-- Empty State -->
<div class="content-section">
    <div class="container">
        <div class="empty-state">
            {% if query %}
                <div class="empty-state-icon">ğŸ”</div>
                <h2 class="empty-state-title">No Decks Found</h2>
                <p class="empty-state-description">
                    No public decks match your search for "<strong>{{ query }}</strong>". Try a different search term.
                </p>
                <a href="{{ url_for('decks.public') }}" class="btn btn-secondary">
                    â† Browse All Decks
                </a>
            {% else %}
                <div class="empty-state-icon">ğŸŒ</div>
                <h2 class="empty-state-title">No Public Decks Yet</h2>
                <p class="empty-state-description">
                    Be the first to create and share a public deck with the community!
                </p>
                {% if current_user.is_authenticated %}
                <a href="{{ url_for('decks.create') }}" class="btn btn-primary">
                    â• Create First Public Deck
                </a>
                {% else %}
                <a href="{{ url_for('auth.register') }}" class="btn btn-primary">
                    ğŸš€ Join to Create Decks
                </a>
                {% endif %}
            {% endif %}
        </div>
    </div>
</div>
{% endif %}

<div style="height: 80px;"></div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        {% if decks %}
            FlashFlow.showToast('Found {{ decks|length }} public deck{{ "s" if decks|length != 1 else "" }}', 'success', 3000);
        {% endif %}

        // Search keyboard shortcut
        document.addEventListener('keydown', function(e) {
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                const searchInput = document.querySelector('input[name="query"]');
                if (searchInput) {
                    searchInput.focus();
                    searchInput.select();
                }
            }
        });
    });
</script>
{% endblock %}
